<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upcoming Games</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <style>
        .table-container {
            overflow-x: auto;
            max-height: 80vh;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            table-layout: auto; /* Allow columns to adjust dynamically */
        }

        th, td {
            text-align: center;
            padding: 5px; /* Reduced padding for tighter spacing */
            white-space: nowrap; /* Prevent text wrapping */
        }

        /* Sticky Columns */
        th.sticky,
        td.sticky {
            position: sticky;
            left: 0;
            z-index: 1;
            background-color: #f8f9fa;
            border-right: 1px solid #dee2e6;
        }

        th.sticky-2,
        td.sticky-2 {
            left: 100px;
        }

        th.sticky-3,
        td.sticky-3 {
            left: 300px;
        }

        th.sticky-4,
        td.sticky-4 {
            left: 600px;
        }

        /* Sortable Columns */
        th.sortable {
            cursor: pointer;
        }

        th.sortable:hover {
            background-color: #f1f1f1;
        }
    </style>
</head>
<body class="container">
    <h1 class="mt-5">Upcoming Games</h1>

    <!-- Date Range Form -->
    <form method="POST" class="row g-3 mt-3">
        {% csrf_token %}
        <div class="col-md-6">
            <label for="startdate" class="form-label">Start Date</label>
            <input type="date" id="startdate" name="startdate" class="form-control" required>
        </div>
        <div class="col-md-6">
            <label for="enddate" class="form-label">End Date</label>
            <input type="date" id="enddate" name="enddate" class="form-control" required>
        </div>
        <div class="col-12">
            <button type="submit" class="btn btn-primary">Fetch Games</button>
        </div>
    </form>

    <!-- Error Message -->
    {% if error_message %}
        <div class="alert alert-danger mt-3">
            {{ error_message }}
        </div>
    {% endif %}

    <!-- Games Table -->
    {% if games %}
        <div class="table-container">
            <table id="games-table" class="table table-striped mt-3">
                <thead>
                    <tr>
                        <th class="sticky sortable">Game Date</th>
                        <th class="sticky sticky-2 sortable">League</th>
                        <th class="sticky sticky-3 sortable">Home Team</th>
                        <th class="sticky sticky-4 sortable">Away Team</th>
                        <th class="sortable">Season</th>
                        <th class="sortable">Status</th>
                        <th class="sortable">Game Week</th>
                        <th class="sortable">Home Corners Avg</th>
                        <th class="sortable">Away Corners Avg</th>
                        <th class="sortable">Corners Diff</th>
                        <th class="sortable">Home Shots</th>
                        <th class="sortable">Away Shots</th>
                        <th class="sortable">Shots Diff</th>
                        <th class="sortable">Home Shots on Target</th>
                        <th class="sortable">Away Shots on Target</th>
                        <th class="sortable">Shots on Target Diff</th>
                        <th class="sortable">Home Yellow Cards</th>
                        <th class="sortable">Away Yellow Cards</th>
                        <th class="sortable">Yellow Cards Diff</th>
                    </tr>
                </thead>
                <tbody>
                    {% for game in games %}
                        <tr>
                            <td class="sticky">{{ game.date }}</td>
                            <td class="sticky sticky-2">
                                <a href="{% url 'football_data' %}?league={{ game.league }}&season={{ game.season }}" class="text-primary">
                                    {{ game.league }}
                                </a>
                            </td>
                            <td class="sticky sticky-3">{{ game.home_team_name }}</td>
                            <td class="sticky sticky-4">{{ game.away_team_name }}</td>
                            <td>{{ game.season }}</td>
                            <td>{{ game.status }}</td>
                            <td>{{ game.game_week }}</td>
                            <td>{{ game.home_corners_avg }}</td>
                            <td>{{ game.away_corners_avg }}</td>
                            <td>{{ game.corners_diff }}</td>
                            <td>{{ game.home_shots }}</td>
                            <td>{{ game.away_shots }}</td>
                            <td>{{ game.shots_diff }}</td>
                            <td>{{ game.home_shots_on_target }}</td>
                            <td>{{ game.away_shots_on_target }}</td>
                            <td>{{ game.shots_on_target_diff }}</td>
                            <td>{{ game.home_yellow_cards }}</td>
                            <td>{{ game.away_yellow_cards }}</td>
                            <td>{{ game.yellow_cards_diff }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}

    <a href="{% url 'football_data' %}" class="btn btn-secondary mt-3">Back to League Data</a>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const table = document.getElementById("games-table");
            const headers = table.querySelectorAll("th.sortable");

            headers.forEach((header, index) => {
                header.addEventListener("click", () => {
                    const tbody = table.querySelector("tbody");
                    const rows = Array.from(tbody.querySelectorAll("tr"));
                    const isAscending = header.classList.contains("asc");

                    rows.sort((rowA, rowB) => {
                        const cellA = rowA.children[index].innerText.trim();
                        const cellB = rowB.children[index].innerText.trim();

                        const valA = isNaN(cellA) ? cellA.toLowerCase() : parseFloat(cellA) || 0;
                        const valB = isNaN(cellB) ? cellB.toLowerCase() : parseFloat(cellB) || 0;

                        if (valA < valB) return isAscending ? 1 : -1;
                        if (valA > valB) return isAscending ? -1 : 1;
                        return 0;
                    });

                    headers.forEach((header) => header.classList.remove("asc", "desc"));
                    header.classList.toggle("asc", !isAscending);
                    header.classList.toggle("desc", isAscending);

                    rows.forEach((row) => tbody.appendChild(row));
                });
            });
        });
    </script>
</body>
</html>
